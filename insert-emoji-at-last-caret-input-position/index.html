<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>
    Inserting Text at the Last Known Selection / Caret Position in JavaScript
  </title>

  <link rel="stylesheet" type="text/css" href="./demo.css" />
</head>

<body>

  <h1>
    Inserting Text at the Last Known Selection / Caret Position in JavaScript
  </h1>

  <textarea id="input">
"I'm apprehensive about everything. I'm unnerved by what I witnessed, by my actions, by my very identity. But above all, I'm terrified of leaving this room and never experiencing, for the rest of my existence, the profound emotions I feel when I'm in your presence."
  </textarea>

  <div id="buttons">
    <button>Dummyüéâ</button>
    <button>Spiderüï∑Ô∏è</button>
    <button>‚úÖ</button><!-- slightly smiling face -->
    <button>ü§°</button><!-- frowning face -->
  </div>

  <script type="text/javascript">

    const input = document.getElementById("input");
    const buttons = document.getElementById("buttons");

    // When the user clicks on one of the target text tokens, we will insert
    // that token into the textarea at the last known selection location.
    buttons.addEventListener("click", handleButtonClick);

    function handleButtonClick(event) {
      if (event.target.tagName !== "BUTTON") return;

      const inputValue = input.value;
      // For the sake of simplicity, we're extracting the insertable text directly
      // from the DOM structure. Interestingly, using .textContent will retrieve the emoji
      // glyph that was generated by HTML entities.
      const insertToken = event.target.textContent;

      // Note: Even after the input loses focus, it appears to retain its last-known
      // selection properties. Consequently, we don't need to track these throughout the
      // lifecycle of the page - we can reference them at any time.
      const insertTokenAt = input.selectionEnd;
      // After inserting the text, we'll refocus the input.
      // However, we'll advance the selection to start just after the inserted text.
      const nextSelectionEnd = insertTokenAt + insertToken.length;

      // Insert the text at the specified location within the input.
      input.value =
        inputValue.slice(0, insertTokenAt) +
        insertToken +
        inputValue.slice(insertTokenAt);

      // Advance the text selection to just after the inserted text.
      input.setSelectionRange(nextSelectionEnd, nextSelectionEnd);
      input.focus();
    }

  </script>

</body>

</html>